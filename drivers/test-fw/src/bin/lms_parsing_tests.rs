/*++

Licensed under the Apache-2.0 license.

File Name:

    lms_parsing_tests

Abstract:

    File contains test cases from a sampling of NIST CAVP tests.

--*/

#![no_std]
#![no_main]

use caliptra_drivers::{
    parse_public_contents, parse_signature_contents, LmotsAlgorithmType, Lms, LmsAlgorithmType,
    LmsIdentifier, Sha256,
};
use caliptra_registers::sha256::Sha256Reg;
use caliptra_test_harness::test_suite;

fn test_parse_public() {
    const PUBLIC_KEY_BYTES: [u8; 48] = [
        0, 0, 0, 12, 0, 0, 0, 7, 188, 6, 48, 169, 246, 46, 8, 166, 148, 155, 189, 136, 53, 172,
        103, 136, 236, 113, 144, 218, 165, 27, 86, 46, 64, 175, 168, 88, 50, 42, 60, 25, 191, 78,
        50, 50, 102, 228, 149, 65,
    ];

    const EXPECTED_IDENTIFIER: LmsIdentifier = [
        188, 6, 48, 169, 246, 46, 8, 166, 148, 155, 189, 136, 53, 172, 103, 136,
    ];

    let result = parse_public_contents::<6>(&PUBLIC_KEY_BYTES).unwrap();
    assert_eq!(result.lmots_type, LmotsAlgorithmType::LmotsSha256N24W4);
    assert_eq!(result.lms_type, LmsAlgorithmType::LmsSha256N24H15);
    assert_eq!(result.lms_identifier, EXPECTED_IDENTIFIER);

    let short_key = &PUBLIC_KEY_BYTES[0..4];
    let result = parse_public_contents::<6>(&short_key);
    assert_eq!(result.is_err(), true);

    //ensure an error when an incorrect hash width is specified
    let result = parse_public_contents::<24>(&PUBLIC_KEY_BYTES);
    assert_eq!(result.is_err(), true);
}

fn test_parse_signature() {
    const SIGNATURE_BYTES: [u8; 1620] = [
        0, 0, 0, 0, 0, 0, 0, 7, 127, 115, 9, 162, 194, 8, 231, 134, 30, 51, 124, 55, 14, 58, 127,
        19, 28, 170, 117, 118, 115, 78, 228, 232, 68, 110, 78, 142, 152, 214, 217, 250, 149, 157,
        187, 68, 148, 207, 146, 236, 62, 205, 37, 2, 180, 173, 37, 24, 227, 205, 193, 64, 117, 36,
        117, 33, 157, 213, 197, 147, 95, 106, 28, 128, 253, 53, 104, 68, 41, 39, 27, 37, 147, 180,
        172, 225, 31, 188, 121, 169, 27, 11, 58, 172, 127, 204, 8, 172, 134, 169, 239, 44, 174,
        121, 138, 138, 178, 250, 110, 207, 57, 210, 192, 173, 168, 89, 116, 245, 110, 26, 60, 219,
        134, 81, 133, 220, 41, 61, 82, 44, 153, 213, 97, 65, 44, 147, 167, 76, 53, 62, 96, 167, 76,
        212, 172, 141, 232, 125, 111, 167, 241, 92, 88, 67, 180, 163, 201, 222, 105, 84, 177, 121,
        162, 32, 130, 238, 37, 196, 140, 17, 29, 57, 230, 231, 33, 176, 17, 197, 222, 166, 51, 89,
        114, 251, 201, 189, 175, 248, 61, 188, 196, 83, 179, 253, 203, 99, 154, 37, 138, 6, 20, 50,
        92, 187, 187, 183, 38, 71, 81, 175, 213, 159, 219, 174, 145, 104, 39, 6, 130, 161, 212,
        133, 239, 245, 211, 151, 219, 127, 71, 212, 248, 209, 218, 128, 66, 36, 48, 178, 154, 124,
        227, 197, 162, 49, 113, 118, 251, 42, 114, 203, 48, 164, 181, 10, 36, 211, 200, 241, 171,
        191, 147, 124, 224, 192, 177, 96, 232, 94, 83, 107, 193, 11, 40, 7, 151, 48, 52, 41, 10,
        72, 199, 119, 117, 107, 188, 174, 29, 155, 134, 99, 13, 222, 164, 184, 237, 243, 69, 161,
        39, 116, 18, 58, 187, 37, 99, 25, 111, 80, 113, 121, 35, 254, 80, 41, 38, 192, 85, 44, 82,
        165, 18, 50, 24, 181, 189, 21, 209, 228, 226, 103, 128, 174, 95, 237, 25, 72, 86, 135, 140,
        40, 142, 182, 149, 184, 18, 204, 161, 204, 242, 180, 157, 234, 99, 47, 232, 110, 112, 25,
        212, 169, 146, 80, 8, 5, 224, 42, 77, 126, 215, 208, 30, 21, 238, 218, 191, 227, 143, 101,
        16, 186, 60, 203, 137, 2, 132, 203, 44, 206, 153, 80, 11, 13, 163, 223, 183, 166, 251, 147,
        6, 28, 156, 24, 199, 247, 69, 169, 10, 95, 96, 41, 7, 122, 207, 90, 190, 201, 81, 214, 6,
        247, 125, 189, 178, 158, 74, 57, 219, 28, 187, 193, 189, 211, 173, 230, 117, 248, 255, 103,
        225, 169, 180, 116, 17, 84, 31, 106, 189, 97, 142, 227, 35, 52, 181, 253, 196, 100, 243,
        179, 12, 158, 5, 177, 82, 236, 147, 184, 93, 116, 127, 196, 124, 4, 148, 207, 47, 31, 254,
        247, 33, 248, 98, 16, 227, 114, 155, 35, 89, 148, 242, 175, 60, 237, 120, 94, 11, 17, 234,
        230, 219, 162, 78, 131, 205, 230, 31, 91, 192, 135, 149, 130, 249, 6, 45, 200, 129, 231,
        103, 198, 11, 171, 251, 181, 8, 19, 21, 35, 139, 57, 102, 23, 94, 7, 201, 6, 170, 229, 122,
        25, 75, 157, 234, 219, 106, 64, 79, 134, 49, 47, 19, 194, 208, 230, 145, 194, 120, 62, 113,
        224, 86, 200, 84, 118, 93, 9, 99, 66, 171, 185, 32, 90, 205, 81, 63, 72, 151, 220, 192, 60,
        191, 230, 23, 131, 192, 27, 244, 37, 111, 96, 134, 49, 5, 198, 74, 144, 166, 78, 175, 119,
        1, 53, 202, 113, 244, 127, 49, 153, 171, 177, 142, 133, 124, 45, 126, 192, 140, 234, 223,
        33, 87, 219, 251, 85, 33, 44, 210, 50, 147, 84, 89, 187, 67, 24, 127, 117, 189, 220, 127,
        52, 170, 176, 117, 213, 67, 208, 253, 147, 207, 20, 210, 97, 233, 142, 218, 97, 191, 218,
        160, 98, 173, 91, 79, 119, 209, 73, 170, 17, 114, 98, 91, 216, 186, 192, 239, 1, 201, 244,
        193, 116, 170, 127, 121, 3, 41, 102, 167, 149, 143, 242, 165, 195, 194, 105, 162, 191, 111,
        142, 253, 236, 27, 239, 182, 190, 166, 38, 215, 117, 144, 228, 120, 47, 240, 152, 115, 60,
        165, 159, 48, 11, 142, 220, 59, 164, 112, 24, 44, 92, 116, 208, 49, 8, 236, 155, 154, 28,
        46, 116, 56, 123, 227, 238, 116, 212, 47, 162, 159, 66, 208, 192, 226, 202, 121, 143, 95,
        182, 187, 32, 238, 133, 176, 175, 36, 156, 2, 188, 195, 21, 176, 134, 212, 82, 44, 224, 18,
        174, 43, 199, 126, 148, 4, 214, 6, 135, 30, 31, 46, 35, 66, 6, 88, 72, 92, 44, 36, 234,
        227, 6, 138, 62, 222, 171, 63, 145, 217, 194, 144, 52, 65, 118, 167, 205, 201, 152, 235,
        84, 60, 226, 42, 53, 89, 199, 220, 70, 230, 171, 235, 200, 110, 189, 246, 121, 245, 17,
        245, 122, 121, 177, 48, 134, 198, 230, 76, 106, 161, 94, 51, 35, 20, 240, 216, 74, 63, 38,
        77, 202, 252, 173, 201, 247, 105, 41, 82, 243, 53, 90, 230, 109, 14, 71, 64, 116, 185, 177,
        151, 252, 23, 135, 74, 175, 252, 215, 197, 95, 221, 239, 192, 233, 60, 83, 255, 144, 17,
        21, 1, 40, 121, 106, 163, 63, 210, 25, 101, 163, 20, 122, 225, 147, 216, 52, 105, 182, 187,
        51, 182, 243, 34, 218, 184, 198, 86, 133, 241, 129, 148, 207, 189, 114, 10, 90, 227, 67,
        61, 85, 156, 186, 48, 94, 127, 189, 169, 230, 242, 35, 63, 139, 158, 193, 73, 212, 83, 217,
        167, 1, 226, 1, 185, 117, 25, 101, 37, 93, 219, 209, 230, 57, 235, 53, 3, 171, 224, 6, 127,
        195, 58, 112, 218, 23, 99, 78, 102, 164, 204, 125, 91, 84, 5, 114, 183, 163, 78, 186, 211,
        220, 125, 152, 187, 229, 88, 184, 30, 231, 81, 214, 158, 255, 222, 15, 38, 54, 68, 189,
        202, 80, 152, 198, 185, 209, 103, 161, 35, 126, 86, 70, 28, 87, 149, 177, 244, 54, 214,
        177, 38, 53, 65, 55, 201, 229, 99, 241, 163, 59, 89, 81, 41, 216, 51, 42, 120, 115, 163,
        164, 7, 198, 25, 17, 242, 102, 148, 144, 205, 218, 188, 22, 107, 242, 129, 224, 202, 35,
        202, 27, 209, 20, 221, 214, 206, 19, 112, 161, 95, 220, 42, 96, 230, 140, 122, 132, 29, 65,
        190, 15, 62, 190, 164, 125, 172, 14, 3, 46, 207, 132, 16, 191, 73, 93, 54, 239, 64, 40,
        201, 76, 132, 110, 124, 200, 70, 212, 79, 144, 52, 76, 103, 117, 198, 131, 178, 184, 192,
        145, 160, 31, 166, 248, 94, 243, 104, 88, 215, 49, 238, 162, 114, 248, 246, 199, 221, 243,
        180, 63, 115, 165, 167, 198, 131, 68, 146, 49, 109, 173, 197, 200, 235, 28, 194, 32, 138,
        135, 221, 23, 231, 22, 236, 38, 179, 137, 120, 210, 115, 42, 243, 161, 55, 222, 148, 112,
        51, 184, 27, 228, 65, 9, 58, 176, 158, 190, 140, 129, 153, 15, 201, 36, 156, 169, 92, 123,
        146, 56, 37, 162, 136, 200, 18, 124, 43, 161, 173, 86, 106, 218, 150, 70, 248, 186, 57,
        133, 250, 127, 187, 170, 119, 101, 14, 9, 91, 251, 212, 91, 148, 147, 49, 80, 2, 230, 71,
        126, 61, 64, 83, 41, 217, 93, 219, 199, 98, 122, 12, 245, 55, 51, 0, 0, 0, 12, 122, 93, 77,
        252, 205, 235, 204, 196, 169, 170, 237, 165, 64, 151, 66, 40, 151, 6, 24, 150, 114, 91,
        159, 35, 162, 44, 161, 141, 85, 101, 209, 39, 118, 111, 30, 183, 225, 60, 84, 106, 137, 7,
        250, 247, 141, 12, 59, 160, 178, 73, 152, 160, 98, 49, 189, 28, 169, 171, 69, 87, 67, 224,
        185, 10, 178, 83, 226, 255, 29, 160, 133, 85, 175, 120, 149, 3, 9, 224, 187, 110, 20, 204,
        76, 46, 188, 178, 195, 183, 249, 129, 240, 33, 57, 198, 235, 115, 254, 33, 58, 5, 137, 198,
        103, 224, 230, 35, 33, 162, 250, 197, 242, 178, 81, 218, 225, 75, 36, 8, 230, 198, 100,
        209, 168, 238, 95, 222, 226, 31, 100, 88, 226, 207, 51, 61, 14, 65, 39, 1, 86, 80, 199,
        160, 16, 139, 65, 99, 102, 77, 61, 105, 128, 247, 76, 106, 219, 246, 190, 124, 68, 115,
        175, 113, 179, 183, 187, 228, 173, 103, 5, 177, 108, 204, 64, 6, 131, 216, 13, 126, 99,
        111, 207, 56, 108, 45, 120, 70, 166, 91, 163, 138, 13, 205, 30, 78, 186, 8, 244, 78, 187,
        164, 163, 77, 14, 19, 239, 75, 158, 80, 170, 18, 118, 150, 39, 204, 146, 52, 121, 211, 110,
        235, 204, 73, 207, 77, 174, 144, 127, 126, 206, 184, 202, 218, 180, 41, 161, 151, 203, 52,
        140, 218, 118, 198, 204, 179, 3, 224, 195, 136, 89, 154, 217, 7, 134, 49, 70, 136, 214,
        118, 211, 35, 77, 89, 56, 178, 216, 166, 144, 113, 111, 138, 146, 4, 169, 97, 66, 167, 33,
        102, 115, 34, 152, 230, 21, 217, 177, 162, 233, 160, 211, 237, 82, 138, 68, 245, 118, 145,
        44, 122, 249, 227, 75, 25, 251, 250, 194, 250, 66, 127, 154, 227, 33, 127, 18, 109, 148,
        141, 180, 201, 76, 57, 39, 150, 36, 36, 118, 132, 226, 172, 80, 32, 47, 140, 89, 218, 211,
        95, 202, 186, 62, 50, 233, 94, 75, 36, 207, 12, 72, 41, 181, 117, 248, 111, 247, 74, 211,
        43, 60, 172, 140, 150,
    ];

    let lms_sig = parse_signature_contents::<6, 51, 15>(&SIGNATURE_BYTES).unwrap();
    assert_eq!(lms_sig.q, 0);
    assert_eq!(lms_sig.ots_type, LmotsAlgorithmType::LmotsSha256N24W4);
    assert_eq!(lms_sig.lms_type, LmsAlgorithmType::LmsSha256N24H15);
}

fn test_lms_24_parse_verify() {
    let mut sha256 = unsafe { Sha256::new(Sha256Reg::new()) };
    const PUBLIC_KEY_BYTES: [u8; 48] = [
        0, 0, 0, 12, 0, 0, 0, 7, 188, 6, 48, 169, 246, 46, 8, 166, 148, 155, 189, 136, 53, 172,
        103, 136, 236, 113, 144, 218, 165, 27, 86, 46, 64, 175, 168, 88, 50, 42, 60, 25, 191, 78,
        50, 50, 102, 228, 149, 65,
    ];
    const MESSAGE: [u8; 33] = [
        116, 104, 105, 115, 32, 105, 115, 32, 116, 104, 101, 32, 109, 101, 115, 115, 97, 103, 101,
        32, 73, 32, 119, 97, 110, 116, 32, 115, 105, 103, 110, 101, 100,
    ];
    const SIGNATURE_BYTES: [u8; 1620] = [
        0, 0, 0, 0, 0, 0, 0, 7, 127, 115, 9, 162, 194, 8, 231, 134, 30, 51, 124, 55, 14, 58, 127,
        19, 28, 170, 117, 118, 115, 78, 228, 232, 68, 110, 78, 142, 152, 214, 217, 250, 149, 157,
        187, 68, 148, 207, 146, 236, 62, 205, 37, 2, 180, 173, 37, 24, 227, 205, 193, 64, 117, 36,
        117, 33, 157, 213, 197, 147, 95, 106, 28, 128, 253, 53, 104, 68, 41, 39, 27, 37, 147, 180,
        172, 225, 31, 188, 121, 169, 27, 11, 58, 172, 127, 204, 8, 172, 134, 169, 239, 44, 174,
        121, 138, 138, 178, 250, 110, 207, 57, 210, 192, 173, 168, 89, 116, 245, 110, 26, 60, 219,
        134, 81, 133, 220, 41, 61, 82, 44, 153, 213, 97, 65, 44, 147, 167, 76, 53, 62, 96, 167, 76,
        212, 172, 141, 232, 125, 111, 167, 241, 92, 88, 67, 180, 163, 201, 222, 105, 84, 177, 121,
        162, 32, 130, 238, 37, 196, 140, 17, 29, 57, 230, 231, 33, 176, 17, 197, 222, 166, 51, 89,
        114, 251, 201, 189, 175, 248, 61, 188, 196, 83, 179, 253, 203, 99, 154, 37, 138, 6, 20, 50,
        92, 187, 187, 183, 38, 71, 81, 175, 213, 159, 219, 174, 145, 104, 39, 6, 130, 161, 212,
        133, 239, 245, 211, 151, 219, 127, 71, 212, 248, 209, 218, 128, 66, 36, 48, 178, 154, 124,
        227, 197, 162, 49, 113, 118, 251, 42, 114, 203, 48, 164, 181, 10, 36, 211, 200, 241, 171,
        191, 147, 124, 224, 192, 177, 96, 232, 94, 83, 107, 193, 11, 40, 7, 151, 48, 52, 41, 10,
        72, 199, 119, 117, 107, 188, 174, 29, 155, 134, 99, 13, 222, 164, 184, 237, 243, 69, 161,
        39, 116, 18, 58, 187, 37, 99, 25, 111, 80, 113, 121, 35, 254, 80, 41, 38, 192, 85, 44, 82,
        165, 18, 50, 24, 181, 189, 21, 209, 228, 226, 103, 128, 174, 95, 237, 25, 72, 86, 135, 140,
        40, 142, 182, 149, 184, 18, 204, 161, 204, 242, 180, 157, 234, 99, 47, 232, 110, 112, 25,
        212, 169, 146, 80, 8, 5, 224, 42, 77, 126, 215, 208, 30, 21, 238, 218, 191, 227, 143, 101,
        16, 186, 60, 203, 137, 2, 132, 203, 44, 206, 153, 80, 11, 13, 163, 223, 183, 166, 251, 147,
        6, 28, 156, 24, 199, 247, 69, 169, 10, 95, 96, 41, 7, 122, 207, 90, 190, 201, 81, 214, 6,
        247, 125, 189, 178, 158, 74, 57, 219, 28, 187, 193, 189, 211, 173, 230, 117, 248, 255, 103,
        225, 169, 180, 116, 17, 84, 31, 106, 189, 97, 142, 227, 35, 52, 181, 253, 196, 100, 243,
        179, 12, 158, 5, 177, 82, 236, 147, 184, 93, 116, 127, 196, 124, 4, 148, 207, 47, 31, 254,
        247, 33, 248, 98, 16, 227, 114, 155, 35, 89, 148, 242, 175, 60, 237, 120, 94, 11, 17, 234,
        230, 219, 162, 78, 131, 205, 230, 31, 91, 192, 135, 149, 130, 249, 6, 45, 200, 129, 231,
        103, 198, 11, 171, 251, 181, 8, 19, 21, 35, 139, 57, 102, 23, 94, 7, 201, 6, 170, 229, 122,
        25, 75, 157, 234, 219, 106, 64, 79, 134, 49, 47, 19, 194, 208, 230, 145, 194, 120, 62, 113,
        224, 86, 200, 84, 118, 93, 9, 99, 66, 171, 185, 32, 90, 205, 81, 63, 72, 151, 220, 192, 60,
        191, 230, 23, 131, 192, 27, 244, 37, 111, 96, 134, 49, 5, 198, 74, 144, 166, 78, 175, 119,
        1, 53, 202, 113, 244, 127, 49, 153, 171, 177, 142, 133, 124, 45, 126, 192, 140, 234, 223,
        33, 87, 219, 251, 85, 33, 44, 210, 50, 147, 84, 89, 187, 67, 24, 127, 117, 189, 220, 127,
        52, 170, 176, 117, 213, 67, 208, 253, 147, 207, 20, 210, 97, 233, 142, 218, 97, 191, 218,
        160, 98, 173, 91, 79, 119, 209, 73, 170, 17, 114, 98, 91, 216, 186, 192, 239, 1, 201, 244,
        193, 116, 170, 127, 121, 3, 41, 102, 167, 149, 143, 242, 165, 195, 194, 105, 162, 191, 111,
        142, 253, 236, 27, 239, 182, 190, 166, 38, 215, 117, 144, 228, 120, 47, 240, 152, 115, 60,
        165, 159, 48, 11, 142, 220, 59, 164, 112, 24, 44, 92, 116, 208, 49, 8, 236, 155, 154, 28,
        46, 116, 56, 123, 227, 238, 116, 212, 47, 162, 159, 66, 208, 192, 226, 202, 121, 143, 95,
        182, 187, 32, 238, 133, 176, 175, 36, 156, 2, 188, 195, 21, 176, 134, 212, 82, 44, 224, 18,
        174, 43, 199, 126, 148, 4, 214, 6, 135, 30, 31, 46, 35, 66, 6, 88, 72, 92, 44, 36, 234,
        227, 6, 138, 62, 222, 171, 63, 145, 217, 194, 144, 52, 65, 118, 167, 205, 201, 152, 235,
        84, 60, 226, 42, 53, 89, 199, 220, 70, 230, 171, 235, 200, 110, 189, 246, 121, 245, 17,
        245, 122, 121, 177, 48, 134, 198, 230, 76, 106, 161, 94, 51, 35, 20, 240, 216, 74, 63, 38,
        77, 202, 252, 173, 201, 247, 105, 41, 82, 243, 53, 90, 230, 109, 14, 71, 64, 116, 185, 177,
        151, 252, 23, 135, 74, 175, 252, 215, 197, 95, 221, 239, 192, 233, 60, 83, 255, 144, 17,
        21, 1, 40, 121, 106, 163, 63, 210, 25, 101, 163, 20, 122, 225, 147, 216, 52, 105, 182, 187,
        51, 182, 243, 34, 218, 184, 198, 86, 133, 241, 129, 148, 207, 189, 114, 10, 90, 227, 67,
        61, 85, 156, 186, 48, 94, 127, 189, 169, 230, 242, 35, 63, 139, 158, 193, 73, 212, 83, 217,
        167, 1, 226, 1, 185, 117, 25, 101, 37, 93, 219, 209, 230, 57, 235, 53, 3, 171, 224, 6, 127,
        195, 58, 112, 218, 23, 99, 78, 102, 164, 204, 125, 91, 84, 5, 114, 183, 163, 78, 186, 211,
        220, 125, 152, 187, 229, 88, 184, 30, 231, 81, 214, 158, 255, 222, 15, 38, 54, 68, 189,
        202, 80, 152, 198, 185, 209, 103, 161, 35, 126, 86, 70, 28, 87, 149, 177, 244, 54, 214,
        177, 38, 53, 65, 55, 201, 229, 99, 241, 163, 59, 89, 81, 41, 216, 51, 42, 120, 115, 163,
        164, 7, 198, 25, 17, 242, 102, 148, 144, 205, 218, 188, 22, 107, 242, 129, 224, 202, 35,
        202, 27, 209, 20, 221, 214, 206, 19, 112, 161, 95, 220, 42, 96, 230, 140, 122, 132, 29, 65,
        190, 15, 62, 190, 164, 125, 172, 14, 3, 46, 207, 132, 16, 191, 73, 93, 54, 239, 64, 40,
        201, 76, 132, 110, 124, 200, 70, 212, 79, 144, 52, 76, 103, 117, 198, 131, 178, 184, 192,
        145, 160, 31, 166, 248, 94, 243, 104, 88, 215, 49, 238, 162, 114, 248, 246, 199, 221, 243,
        180, 63, 115, 165, 167, 198, 131, 68, 146, 49, 109, 173, 197, 200, 235, 28, 194, 32, 138,
        135, 221, 23, 231, 22, 236, 38, 179, 137, 120, 210, 115, 42, 243, 161, 55, 222, 148, 112,
        51, 184, 27, 228, 65, 9, 58, 176, 158, 190, 140, 129, 153, 15, 201, 36, 156, 169, 92, 123,
        146, 56, 37, 162, 136, 200, 18, 124, 43, 161, 173, 86, 106, 218, 150, 70, 248, 186, 57,
        133, 250, 127, 187, 170, 119, 101, 14, 9, 91, 251, 212, 91, 148, 147, 49, 80, 2, 230, 71,
        126, 61, 64, 83, 41, 217, 93, 219, 199, 98, 122, 12, 245, 55, 51, 0, 0, 0, 12, 122, 93, 77,
        252, 205, 235, 204, 196, 169, 170, 237, 165, 64, 151, 66, 40, 151, 6, 24, 150, 114, 91,
        159, 35, 162, 44, 161, 141, 85, 101, 209, 39, 118, 111, 30, 183, 225, 60, 84, 106, 137, 7,
        250, 247, 141, 12, 59, 160, 178, 73, 152, 160, 98, 49, 189, 28, 169, 171, 69, 87, 67, 224,
        185, 10, 178, 83, 226, 255, 29, 160, 133, 85, 175, 120, 149, 3, 9, 224, 187, 110, 20, 204,
        76, 46, 188, 178, 195, 183, 249, 129, 240, 33, 57, 198, 235, 115, 254, 33, 58, 5, 137, 198,
        103, 224, 230, 35, 33, 162, 250, 197, 242, 178, 81, 218, 225, 75, 36, 8, 230, 198, 100,
        209, 168, 238, 95, 222, 226, 31, 100, 88, 226, 207, 51, 61, 14, 65, 39, 1, 86, 80, 199,
        160, 16, 139, 65, 99, 102, 77, 61, 105, 128, 247, 76, 106, 219, 246, 190, 124, 68, 115,
        175, 113, 179, 183, 187, 228, 173, 103, 5, 177, 108, 204, 64, 6, 131, 216, 13, 126, 99,
        111, 207, 56, 108, 45, 120, 70, 166, 91, 163, 138, 13, 205, 30, 78, 186, 8, 244, 78, 187,
        164, 163, 77, 14, 19, 239, 75, 158, 80, 170, 18, 118, 150, 39, 204, 146, 52, 121, 211, 110,
        235, 204, 73, 207, 77, 174, 144, 127, 126, 206, 184, 202, 218, 180, 41, 161, 151, 203, 52,
        140, 218, 118, 198, 204, 179, 3, 224, 195, 136, 89, 154, 217, 7, 134, 49, 70, 136, 214,
        118, 211, 35, 77, 89, 56, 178, 216, 166, 144, 113, 111, 138, 146, 4, 169, 97, 66, 167, 33,
        102, 115, 34, 152, 230, 21, 217, 177, 162, 233, 160, 211, 237, 82, 138, 68, 245, 118, 145,
        44, 122, 249, 227, 75, 25, 251, 250, 194, 250, 66, 127, 154, 227, 33, 127, 18, 109, 148,
        141, 180, 201, 76, 57, 39, 150, 36, 36, 118, 132, 226, 172, 80, 32, 47, 140, 89, 218, 211,
        95, 202, 186, 62, 50, 233, 94, 75, 36, 207, 12, 72, 41, 181, 117, 248, 111, 247, 74, 211,
        43, 60, 172, 140, 150,
    ];

    let pk = parse_public_contents::<6>(&PUBLIC_KEY_BYTES).unwrap();

    let lms_sig = parse_signature_contents::<6, 51, 15>(&SIGNATURE_BYTES).unwrap();
    let check = Lms::default()
        .verify_lms_signature(&mut sha256, &MESSAGE, &pk, &lms_sig)
        .unwrap();
    assert!(check);

    // this should fail
    let check = Lms::default()
        .verify_lms_signature(&mut sha256, &"blah".as_bytes(), &pk, &lms_sig)
        .unwrap();
    assert!(!check);
}

test_suite! {
    test_parse_public,
    test_parse_signature,
    test_lms_24_parse_verify,
}
